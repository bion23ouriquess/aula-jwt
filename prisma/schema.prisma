generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:senai@127.0.0.1:3306/auth_db"
}

enum PedidoStatus {
  ABERTO
  CONCLUIDO
}

model User {
  id        Int    @id @default(autoincrement())
  nome      String
  email     String @unique
  senhaHash String

  pedidos pedido[]

  @@map("user")
}

model produto {
  id           Int              @id @default(autoincrement())
  nome         String
  precoCents   Int
  criadoEm     DateTime         @default(now())
  atualizadoEm DateTime         @updatedAt
  itensPedido  pedido_produto[]
}

model pedido {
  id        Int          @id @default(autoincrement())
  valor     Decimal
  status    PedidoStatus @default(ABERTO)
  userId    Int
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  user  User             @relation(fields: [userId], references: [id])
  itens pedido_produto[]
}

model pedido_produto {
  id         Int @id @default(autoincrement())
  pedidoId   Int
  produtoId  Int
  quantidade Int @default(1)

  pedido  pedido  @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto produto @relation(fields: [produtoId], references: [id], onDelete: Restrict)

  @@unique([pedidoId, produtoId]) // evita duplicidade do mesmo produto no mesmo pedido
}
